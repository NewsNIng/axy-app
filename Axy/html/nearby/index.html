<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<script type="text/javascript" src="../../js/common/flexible.js"></script>
		<link href="../../css/lib/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="../../css/app/app.css" />
		<style type="text/css">
			/*.mui-search {
				margin: 0 auto;
				width: 7.12rem;
				pointer-events: none;
			}
			
			@media only screen 
			and (max-device-width : 320px) {
			    .mui-search {
					width: 6.12rem;
				}
			}*/
			/*搜索框图标*/
			/*.mui-icon-search:before {
				line-height: 45px;
			}
			
			.mui-search>input {
				border-radius: 15px;
				background-color: #FFFFFF;
			}
			
			.mui-placeholder>span {
				color: #878787;
				font-size: 12px;
			}
			
			.mui-search .mui-placeholder .mui-icon {
			    font-size: 15px;
			    color: #333;
			}*/
			/*tab*/
			
			.tabroom {
				background-color: #FFFFFF;
				width: 100%;
				/*height: 1.066666rem;*/
				height: 1.386666rem;
				/*height: 1.386666rem;*/
				text-align: center;
				border-bottom: 1px solid #EFEFF4;
			}
			
			.tabroom>div {
				text-align: center;
				padding: 0;
				margin: 0 .38rem;
				font-weight: bold;
				display: inline-block;
				/*line-height: 1.386666rem;*/
				letter-spacing: .01rem;
				/*line-height: 1.066666rem;*/
				line-height: 1.386666rem;
				color: #A8A8A8;
				position: relative;
			}
			
			.tabroom>div.app-color-main:before {
				content: "";
				width: 90%;
				height: 0.053333rem;
				background-color: #2BB8AA;
				display: block;
				position: absolute;
				left: 5%;
				border-radius: .1rem;
				/*bottom: 0.293333rem;*/
				bottom: 0.3rem;
			}
			/*搜索框头部*/
			/*.mui-bar {
				padding: 0 0 0 0.346666rem;
			}
			*/
			
			.app-input-room input::-webkit-input-placeholder {
				font-size: 12px !important;
				color: #9F9FA0 !important;
			}
			
			[data-dpr="2"] .app-input-room input::-webkit-input-placeholder {
				font-size: 24px !important;
			}
			
			[data-dpr="3"] .app-input-room input::-webkit-input-placeholder {
				font-size: 36px !important;
			}
			
			.app-input-room {
				width: 8.5rem;
				position: relative !important;
			}
			
			.app-input-room>span.mui-icon {
				position: absolute;
				left: 10px;
				top: 0;
			}
			
			.app-input-room>span.mui-icon.close {
				/*display: none;*/
				left: initial;
				right: 10px;
			}
			/*.app-input-room.active>span.mui-icon.close {
				display: block;
			}*/
			
			.app-input-room img {
				width: 16px;
			}
			
			.app-input-room input {
				width: 100%;
				padding-left: .8rem !important;
				text-align: left !important;
				border-radius: 50px !important;
				background-color: #FFFFFF !important;
			}
			/*end搜索框头部*/
			
			header {
				display: flex;
				display: -webkit-flex;
			}
			
			.arrowdown>.mui-icon {
				/*line-height: 40px;*/
				padding: 15px 15px 0 15px !important;
				font-weight: bold;
				height: 100%;
			}
			
		</style>
	</head>

	<body>

		<div class="warp">
			<header class="mui-bar mui-bar-nav app-header">
				<div class="arrowdown">
					<span class="app-color-white app-font-size-28 mui-pull-left" v-text="city" style="line-height: 45px;" @tap="onHeaderCityTap()"></span>
					<a class="mui-icon mui-icon-arrowdown app-font-size-26 app-color-white" @tap="onHeaderCityTap()" style="font-size: 20px; padding-top: 12px;"></a>
				</div>

				<div class="app-input-room" style="flex: 1;">
					<span class="mui-icon">
						<img src="../../image/search/search@3x.png"/>
					</span>
					<input readonly class="app-font-size-24" type="search" placeholder="你想要的吃喝玩乐">
				</div>
				<a class="app-icon-plus" style="margin-left: 10px;" @tap="onHeaderAddTap()"></a>
			</header>
			<!--<header class="mui-bar mui-bar-nav app-header">

				<span class="app-color-white app-font-size-24 mui-pull-left" v-text="city" style="line-height: 45px;" @tap="onHeaderCityTap()"></span>
				<a class="mui-icon mui-icon-arrowdown app-color-white" @tap="onHeaderCityTap()" style="font-size: 20px; padding-top: 12px;"></a> 

				<h1 class="mui-title" style="left: initial;">
			    	<div class="mui-input-row mui-search">
			    	    <input type="search" placeholder="输入商品名或店铺名">
			    	</div>
			    </h1>
			    <a class="mui-pull-right app-icon-plus" @tap="onHeaderAddTap()"></a>
			</header>-->

			<div class="mui-content">
				<div class="tabroom">
					<template v-for="o, i in tab.items">
						<div class="app-font-size-32" :class="{'app-color-main': tab.active === i}" @tap="onTabTap(o, i)">
							{{o.name}}
						</div>
					</template>

				</div>

			</div>
		</div>

		<!--沉浸式动态处理-->
		<script type="text/javascript" src="../../js/common/immersed.js"></script>
		<script src="../../js/lib/mui.min.js"></script>
		<!--图片缓存处理-->
		<script type="text/javascript" src="../../js/lib/md5.min.js"></script>
		<script type="text/javascript" src="../../js/common/imagelazyload.js"></script>

		<script type="text/javascript" src="../../js/app/app.js"></script>
		<script type="text/javascript" src="../../js/lib/vue.min.js"></script>
		<script type="text/javascript" src="../../js/lib/vue-ni.js"></script>

		<script type="text/javascript" src="../../js/extend/String.js"></script>

		<script type="text/javascript" src="../../js/app/app-page.js"></script>

		<script type="text/javascript">
			// 3个子webview统一样式
			var _styles = {
				bottom: '0px',
				top: '0px'
			};

			(function($) {
				$.init();
				$.ready(function() {
					$('.app-input-room')[0].addEventListener('tap', function() {
						mui.openWindow('../search/index.html', 'search', {
							show: {
								aniShow: 'slide-in-bottom'
							}
						});
					});

				});
			}(mui));

			new Vue({
				el: '.warp',
				data: {
					city: "深圳",
					tab: {
						active: 0,
						items: [{
								name: "附近",
								id: 'nearby_pages_list',
								url: './pages/list.html'
							},
							{
								name: "主题",
								id: 'theme',
								url: './pages/theme.html'
							},
							{
								name: "发现",
								id: 'discover',
								url: './pages/discover.html'
							}
						],
						menuState: false,
					}
				},
				mounted: function() {

				},
				plusReady: function() {
					// plus ready !
					// 这时候才能调用 plus 相关 API
					_styles.top = document.body.offsetHeight + immersed + 'px';

					var items = this.tab.items.map(function(o) {
						o.styles = _styles;
						o.extras = {};
						return o;
					});

					this.group = new this.$WebviewGroup(plus.webview.currentWebview().id, {
						items: items,
						onChange: this.onChange.bind(this)
					});

					var css = document.createElement('style');
					css.innerText = ".mui-pull-top-pocket{top: " + _styles.top + " !important;}"

					document.body.appendChild(css);

					this._preload();

					this._listenMore();
				},
				methods: {
					// 页面切换时
					onChange: function(o) {
						if(this.tab.active === o.index) {
							return;
						}
						this.tab.active = o.index;
					},

					onTabTap: function(o, i) {
						if(this.tab.active === i) {
							return;
						}
						this.tab.active = i;
						// 控制webview切换
						this.group.switchTab(o.id);
					},
					// 城市选择点击
					onHeaderCityTap: function() {
						app.page.getPosition(function(data) {
							this.city = data.city;
							// 通知经纬度变化
							new this.$Broadcast().emit("city_change", {
								longitude: data.longitude,
								latitude: data.latitude,
								city: data.city
							}, {
								views: ['nearby_pages_list']
							});
						}.bind(this));
					},
					// 添加按钮点击
					onHeaderAddTap: function() {
						this._menuShow();
						this.menuState = true;
					},
					// 预加载菜单
					_preload: function() {
						this.menu = mui.preload({
							url: 'menu.html',
							id: 'nearby_menu',
							styles: {
								background: 'transparent'
							}
						});
						//this.$view.append(this.menu);
					},
					_menuShow: function() {
						this.menu && this.menu.show('none');
					},
					_menuHide: function() {
						this.menu && this.menu.hide('none');
					},

					_listenMore: function() {
						new ni.Broadcast().on('tabar', function(data) {
							this.onTabTap(this.tab.items[data.nindex], data.nindex);
						}.bind(this));
					}
				}
			});
		</script>
	</body>

</html>