<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>AI+日志</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<script type="text/javascript" src="../../../js/common/flexible.js"></script>
		<link href="../../../css/lib/mui.min.css" rel="stylesheet" />
		<!--<link rel="stylesheet" href="../../../css/lib/mui.picker.css" />
		<link rel="stylesheet" href="../../../css/lib/mui.poppicker.css" />
		<link rel="stylesheet" href="../../../css/app/app.poppicker.css" />-->

		<link rel="stylesheet" href="../css/mui.min.css">
		<link rel="stylesheet" href="../../../css/app/app.css" />
		<!--<link rel="stylesheet" href="../../../css/app/devices.css" />-->

		<style type="text/css">
			html,
			body,
			.mui-content {
				background-color: white;
				height: 100%;
			}
			
			#warpper {
				height: 100%;
			}
			
			.mui-content {
				/*padding-bottom: 0;*/
			}
			
			.top {
				height: 1.2rem;
				border-bottom: 1px solid #CDCDCD;
				padding: 0 0.346666rem;
				display: flex;
				display: -webkit-flex;
				justify-content: space-around;
				line-height: 1.2rem;
				color: #666666;
			}
			
			.top>a>div:active {
				color: #06C1AE;
			}
			
			.top>a {
				color: #666666;
			}
			
			.top>a>div>img {
				height: 0.4rem;
				width: 0.4rem;
				vertical-align: middle;
			}
			
			.log_all {
				padding: 0.346666rem 0.346666rem 0 0.346666rem;
			}
			
			.log {
				display: flex;
				display: -webkit-flex;
				justify-content: space-between;
				padding-top: 0.213333rem;
				padding-bottom: 0.426666rem;
				color: #323232;
				height: 1.813333rem;
			}
			
			.from {
				color: #8C8C8C;
			}
			
			.date {
				color: #9F9FA0;
			}
			
			.box {
				width: 100%;
				height: 100%;
				display: flex;
				/*background-color: blueviolet;*/
			}
			
			.box_1 {
				margin-top: 0.56rem;
				flex: 1;
				/*background-color: red;*/
				position: relative;
			}
			
			.box_1:after {
				position: absolute;
				right: 0.1rem;
				bottom: 0;
				top: 0;
				width: 1px;
				height: 100%;
				content: '';
				background-color: #d9d9d9;
			}
			
			.box_2 {
				flex: 4;
				/*background-color: yellow;*/
			}
			
			.point {
				float: right;
				width: 0.24rem;
			}
			
			.icon {
				float: right;
				width: 42px;
				position: absolute;
				top: -9px;
				left: 55%;
				transform: translateX(-50%);
				-webkit-transform: translateX(-50%);
			}
			
			.img {
				height: 1.815rem;
				/*background-color: gray;*/
				position: relative;
			}
			
			.wrapper {
				overflow: hidden;
				height: 100%;
			}
			
			.mui-popover {
				width: 2.8rem;
			}
			
			.mui-popover a {
				margin: 0 !important;
				text-align: center;
				height: 1rem;
				line-height: 1rem;
			}
			
			.mui-popover li {
				height: 1rem;
				padding: 0 !important;
			}
			
			.mui-popover .mui-table-view-cell:after {
				left: 0;
			}
			/*.mui-popover .mui-popover-arrow {
				top: -38px;
			}*/
			/*#topPopover1 {
				display: block;
				top: 2.373333rem;
				left: 7.60938px;
			}*/
			
			.mui-popover {
				border-radius: 0;
				top: 2.373333rem !important;
				/*left: 0 !important;*/
			}
			
			.mui-popover .mui-popover-arrow:after {
				border-radius: 0;
				top: 19px !important;
			}
			
			.mui-popover .mui-popover-arrow {
				top: -0.586666rem !important;
				left: 1.4rem !important;
				transform: translateX(-50%);
				-webkit-transform: translateX(-50%);
			}
			
			.newPopover {
				top: 2.83rem !important;
			}
		</style>
	</head>

	<body>
		<div id="warpper">

			<header class="mui-bar mui-bar-nav app-header" data-top='0' data-offset='150' data-duration='16'>
				<a class="mui-action-back app-icon-back mui-pull-left"></a>
				<h1 class="mui-title">AI+日志</h1>
			</header>

			<div class="mui-content app-font-size-32">
				<div class="top app-font-size-28" @tap="console.log(JSON.stringify(document.getElementById('topPopover1').style.top))" ref=tabroom>
					<!--<div @tap="test()">操作<img src="../../../image/smart/devices/others/down.png" /></div>-->
					<a href="#topPopover1">
						<div>操作<img src="../../../image/smart/devices/others/down.png" /></div>
					</a>
					<a href="#topPopover2">
						<div>终端<img src="../../../image/smart/devices/others/down.png" /></div>
					</a>
					<a href="#topPopover3">
						<div>账号<img src="../../../image/smart/devices/others/down.png" /></div>
					</a>
					<a href="#topPopover4">
						<div>日期<img src="../../../image/smart/devices/others/down.png" /></div>
					</a>
				</div>

				<div class="scroll wrapper" ref="wrapper">
					<div>
						<div class="box">
							<div class="box_1">
								<template v-for="o,i in logs">
									<div class="img">
										<img class="point" src="../../../image/smart/devices/electric/point.png" />
										<img class="icon" :src="o.eventid == '2'?'../../../image/smart/devices/btn_Deploytroopsfordefence@3x.png':o.eventid == '3'?'../../../image/smart/devices/btn_Disarm@3x.png':'../../../image/smart/devices/restart.png'" />
									</div>
								</template>
							</div>
							<div class="box_2">
								<div class="log_all">
									<template v-for="o,i in logs">
										<div class="log">
											<div class="account">{{o.handlers ? o.handlers:"未知"}}<br /><span class="from app-font-size-28">来自：{{hdtypes[o.hdtypeid - 1]}}</span></div>
											<div class="state app-font-size-32">{{o.eventid == '2'?'布防成功':o.eventid == '3'?'撤防成功':'重启成功'}}</div>
											<div class="date app-font-size-28">{{o.attime.split(" ")[0]}}<br />{{o.attime.split(" ")[1]}}</div>
										</div>
									</template>
								</div>
							</div>
						</div>
					</div>
				</div>

			</div>

			<!--右上角弹出菜单-->
			<div id="topPopover1" class="mui-popover app-font-size-28">
				<div class="mui-popover-arrow"></div>
				<ul class="mui-table-view">
					<li class="mui-table-view-cell" @tap="onSelectTap(0,'')">
						<a href="#">全部</a>
					</li>
					<li class="mui-table-view-cell" @tap="onSelectTap(0,'1')">
						<a href="#">重启</a>
					</li>
					<li class="mui-table-view-cell" @tap="onSelectTap(0,'2')">
						<a href="#">布防</a>
					</li>
					<li class="mui-table-view-cell" @tap="onSelectTap(0,'3')">
						<a href="#">撤防</a>
					</li>
				</ul>
			</div>
			<div id="topPopover2" class="mui-popover app-font-size-28">
				<div class="mui-popover-arrow"></div>
				<ul class="mui-table-view">
					<li class="mui-table-view-cell" @tap="onSelectTap(1,'')">
						<a href="#">全部</a>
					</li>
					<li class="mui-table-view-cell" @tap="onSelectTap(1,'1')">
						<a href="#">网页</a>
					</li>
					<li class="mui-table-view-cell" @tap="onSelectTap(1,'2')">
						<a href="#">遥控器</a>
					</li>
					<li class="mui-table-view-cell" @tap="onSelectTap(1,'3')">
						<a href="#">APP</a>
					</li>
					<li class="mui-table-view-cell" @tap="onSelectTap(1,'4')">
						<a href="#">PC播放器</a>
					</li>
					<li class="mui-table-view-cell" @tap="onSelectTap(1,'5')">
						<a href="#">联防</a>
					</li>
					<li class="mui-table-view-cell" @tap="onSelectTap(1,'6')">
						<a href="#">计划任务</a>
					</li>
				</ul>
			</div>
			<div id="topPopover3" class="mui-popover app-font-size-28">
				<div class="mui-popover-arrow"></div>
				<ul class="mui-table-view">
					<li class="mui-table-view-cell" @tap="onSelectTap(2,'')">
						<a href="#">全部</a>
					</li>
					<template v-for="o,i in accounts">
						<li class="mui-table-view-cell" v-if="o.handlers" @tap="onSelectTap(2,o.handlers)">
							<a href="#">{{o.handlers}}</a>
						</li>
					</template>
				</ul>
			</div>
			<div id="topPopover4" class="mui-popover app-font-size-28">
				<div class="mui-popover-arrow"></div>
				<ul class="mui-table-view">
					<li class="mui-table-view-cell" @tap="onSelectTap(3,'')">
						<a href="#">全部</a>
					</li>
					<li class="mui-table-view-cell" @tap="onSelectTap(3,'')">
						<a href="#">一周</a>
					</li>
					<li class="mui-table-view-cell" @tap="onSelectTap(3,'')">
						<a href="#">一个月</a>
					</li>
					<li class="mui-table-view-cell" @tap="onSelectTap(3,'')">
						<a href="#">三个月</a>
					</li>
					<li class="mui-table-view-cell" @tap="onSelectTap(3,'')">
						<a href="#">一年</a>
					</li>
				</ul>
			</div>
		</div>
		<!--沉浸式动态处理-->
		<script type="text/javascript" src="../../../js/common/immersed.js"></script>

		<!--基础库-->
		<script type="text/javascript" src="../../../js/lib/mui.min.js"></script>
		<script type="text/javascript" src="../../../js/lib/vue.min.js"></script>
		<script type="text/javascript" src="../../../js/lib/vue-ni.js"></script>
		<!--请求相关-->
		<script type="text/javascript" src="../../../js/dal/base.js"></script>
		<script type="text/javascript" src="../../../js/dal/device.js"></script>
		<!--<script type="text/javascript" src="../../../js/dal/devaccessory.js" ></script>-->
		<!--App相关业务逻辑-->
		<script type="text/javascript" src="../../../js/app/app.js"></script>
		<script src="../../../js/lib/better-scroll.min.js"></script>

		<!--<script type="text/javascript" src="../../../js/lib/md5.min.js"></script>-->
		<!--<script type="text/javascript" src="../../../js/common/imagelazyload.js"></script>-->

		<!--<script type="text/javascript" src="../../../js/lib/mui.picker.js"></script>
		<script type="text/javascript" src="../../../js/lib/mui.poppicker.js"></script>
		<script type="text/javascript" src="arr.js"></script>-->
		<script type="text/javascript">
			mui.init();
			mui('body').on('shown', '.mui-popover', function(e) {
				//console.log('shown', e.detail.id);//detail为当前popover元素
			});
			mui('body').on('hidden', '.mui-popover', function(e) {
				//console.log('hidden', e.detail.id);//detail为当前popover元素
			});
			new Vue({
				el: '#warpper',
				data: function() {
					return {
						n: 0,
						isPwdProtection: true, // 是否开启密码保护
						devId: "",
						hdtypes: ["网页", "遥控器", "APP", "PC播放器", "联防", "计划任务"],
						logs: [],
						accounts: [
							//						{
							//							"count": 43,
							//							"handlers": "webserver"
							//						}
						],
						eventid: undefined,
						hdtypeid: undefined,
						handlers: undefined,
						attime: undefined,
						selectItems: ["topPopover1", "topPopover2", "topPopover3", "topPopover4"],
					};
				},
				mounted: function() {
					document.getElementById("topPopover1").className += ' newPopover';
					document.getElementById("topPopover2").className += ' newPopover';
					document.getElementById("topPopover3").className += ' newPopover';
					document.getElementById("topPopover4").className += ' newPopover';
					//					document.styleSheets[0].addRule('.newPopover','top: 2.8rem !important');
					var wrapper = this.$refs.wrapper;
					var wrapperHight = (document.documentElement.clientHeight || document.body.clientHeigth) -
						this.$refs.tabroom.offsetHeight -
						immersed -
						44;

					wrapper.style.height = wrapperHight + 'px';
					//					document.getElementById("topPopover1").style.top = 0;
					this.$nextTick(function() {
						if(!this.scroll) {
							this.scroll = new BScroll(wrapper, {
								pullUpLoad: {
									threshold: -70, // 负值是当上拉到超过低部 70px；正值是距离底部距离 时，                    
								}
							});
							this.scroll.on('pullingUp', function() {
								// 获取更多 TODO
								this.searchResult();
							}.bind(this));

						} else {
							this.scroll.refresh();
						}
					}.bind(this));
				},
				plusReady: function() {
					document.getElementById("topPopover1").className += ' newPopover';
					this.devId = this.$view.devId;
					this.searchResult();
				},
				methods: {
					// 切换开关
					toggleSwitch: function() {
						this.state = !this.state;
					},
					// 加载
					searchResult: function() {
						this.n++;
						this.$nextTick(function() {
							this.scroll && (this.scroll.finishPullUp(), this.scroll.refresh());
						}.bind(this));
						dal.device.logs.list(this.n, this.devId, function(err, data) {
							if(err) {
								return mui.toast(err.message);
							}
							console.log(JSON.stringify(data));

							if(!data.result || !data.result) {
								//								alert(JSON.stringify(data)+"\t"+data+data.length);
								mui.toast('没有更多啦~~');
							} else {
								this.logs.push.apply(this.logs, data.result);
								if(!this.accounts.length) {
									this.accounts = data.handlers;
								}
							}
						}.bind(this), "", this.eventid, this.hdtypeid, this.handlers, this.attime);
					},
					onSelectTap: function(i, value) {
						mui('#' + this.selectItems[i]).popover('hide');
						this._onClearSelect();
						if(i === 0) {
							this.eventid = value;
						} else if(i === 1) {
							this.hdtypeid = value;
						} else if(i === 2) {
							this.handlers = value;
						} else if(i === 3) {
							this.attime = value;
						}
						this.searchResult();
					},
					_onClearSelect: function() {
						this.n = 0;
						this.logs = [];
						this.eventid = "";
						this.hdtypeid = "";
						this.handlers = "";
						this.attime = "";
					},
					// 接口测试
					test: function() {
						mui.openWindow('test.html', 'test');
						// 获取用户所有配件
						//						dal.devaccessory.allacc(function(data){
						//							alert(JSON.stringify(data));
						//						});
						// 设置智能灯控
						//						dal.devaccessory.getStatus("14255286","20","VH-104GN-2017061500015","20",function(data){
						//							alert(JSON.stringify(data));
						//						});

						//						alert("==接口测试==");
					}
				}
			});
		</script>
	</body>

</html>